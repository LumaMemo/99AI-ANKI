# 知识点卡片查看器 UI 设计方案 (2025-12-27)

## 1. 概述
本方案旨在为用户提供一个优雅、直观的界面，用于浏览和查看从 PDF 提取并处理后的知识点卡片。系统将模拟文件管理器的层级结构，并以艺术化的卡片形式展示知识点内容，支持 Markdown 渲染和 LaTeX 数学公式。

## 2. 数据结构与深度分析
- **根目录**: `anki_card_all/`
- **层级逻辑**: 
    - **目录层级 (Level 1-3/4)**: 模拟 Windows 资源管理器，支持无限层级或动态深度。
    - **知识点叶子节点 (Topic)**: 任何包含 `base.json` 的文件夹即被视为一个“知识点 Topic”。
    - **动态深度**: 
        - 场景 A: `L1 > L2 > L3 > Topic(Folder) > base.json`
        - 场景 B: `L1 > L2 > L3 > L4 > Topic(Folder) > base.json`
- **核心字段解析 (`base.json`)**:
    - `topic`: 知识点标题。
    - `type`: 知识范式（见下文颜色系统）。
    - `content`: **高度结构化对象**，支持嵌套字典、列表及混合类型。
    - `page_idx`: 来源页码。
    - `difficulty`: 难度等级。
    - `uid`: 唯一标识符。

## 3. 知识范式视觉系统 (Six Paradigms Color System)
为增强视觉辨识度，针对六种知识范式设计专属色系（采用艺术大师级莫兰迪色调）：

| 范式 (Type) | 推荐颜色 | 视觉寓意 | 适用场景 |
| :--- | :--- | :--- | :--- |
| **Concept (概念)** | `#60A5FA` (柔和蓝) | 清晰、定义、基石 | 名词解释、核心定义 |
| **Fact (事实)** | `#34D399` (薄荷绿) | 真实、稳固、客观 | 历史事件、地理常识、固定数据 |
| **Rule/Logic (规则)** | `#A78BFA` (丁香紫) | 权威、结构、严谨 | 法律条款、数学定理、物理定律 |
| **Procedure (过程)** | `#FBBF24` (琥珀黄) | 流程、动作、指引 | 实验步骤、算法流程、操作指南 |
| **Symbol (符号)** | `#F87171` (珊瑚红) | 精准、核心、警示 | 核心公式、化学方程式、专业记号 |
| **Case (案例)** | `#2DD4BF` (松石翠) | 实践、应用、探索 | 典型例题、代码片段、案例分析 |

## 4. 界面布局设计

### 4.1 智能目录树 (Smart Sidebar)
- **风格**: Windows 资源管理器左侧快捷栏风格，极简线条。
- **深度自适应**: 
    - 自动探测文件夹内容。如果文件夹内直接含有 `base.json`，则图标切换为“卡片”样式。
    - 支持点击展开/折叠，选中项背景高亮并带有左侧 Accent Color 条。
- **搜索过滤**: 顶部提供实时搜索框，可快速过滤目录名或 Topic 名。

### 4.2 知识点展示区 (Main View)
- **面包屑 (Breadcrumbs)**: 动态显示完整路径，如 `医学 > 基础医学院 > 药理学 > 抗菌药物 > 阿莫西林`。
- **卡片列表 (Topic Grid)**: 
    - 当点击非叶子节点目录时，右侧展示该目录下所有 Topic 的预览卡片。
    - 卡片顶部带有对应范式的颜色条。
- **艺术大师详情页 (Detail View)**:
    - **沉浸式体验**: 隐藏侧边栏（可选），聚焦内容。
    - **排版设计**:
        - **Header**: Topic 居中大标题，下方排列 `Type` (带颜色标签) 和 `Difficulty` (星级或文字)。
        - **Body (递归内容渲染)**: 
            - **Key 转换**: 将 `snake_case` 键名转换为 `Title Case` (如 `rule_statement` -> `Rule Statement`)。
            - **递归逻辑 (参考 Step 8 算法)**:
                - **字典 (Object)**: 渲染为子标题或属性列表。
                - **列表 (Array)**:
                    - 若为对象列表：生成“Item 1”, “Item 2”等子标题并递归。
                    - 若为纯文本列表：渲染为标准 Markdown 无序列表 (`* item`)。
                - **纯文本 (String)**: 
                    - 自动处理换行符 `\n`。
                    - **公式兼容**: 将块级公式 `$$...$$` 转换为行内公式 `$ ... $` 以适配移动端排版，并使用 KaTeX 渲染。
            - **排版风格**: 采用两栏或单栏流式布局，Markdown 渲染支持加粗、引用块。
        - **Footer**: 优雅的分割线，下方显示 `Page Index` 和 `UID`，右侧提供“复制 ID”或“导出”按钮。

## 5. 交互与动效 (Interaction & Motion)
- **平滑过渡**: 目录切换时，右侧内容采用 `fade-in-up` 效果。
- **公式渲染**: 公式加载时带有微小的渐现效果，避免闪烁。
- **响应式适配**:
    - **手机端**: 底部弹出式 Meta 信息，卡片全屏宽度，支持左右滑动切换同级 Topic。
    - **电脑端**: 侧边栏固定，支持拖拽调整宽度。

## 6. 入口集成与搜索增强 (Global Integration & Search)

### 6.1 三大核心入口设计
为了提高功能的发现率和易用性，系统将在以下三个维度深度集成卡片查看器：

#### A. 知识库列表 (PDF 标记)
- **视觉反馈**: 在知识库的 PDF 列表项中，若该文件已生成知识卡片，其图标或背景将呈现“极光紫”渐变边框，或在文件名后方显示一个 **[已生成卡片]** 的微型 Badge。
- **快捷操作**: 鼠标悬停在 PDF 行时，操作栏除了“对话”、“删除”外，新增一个 **“查看卡片”** 的图标按钮（采用 `ri:layout-grid-fill` 图标）。
- **状态区分**: 未生成的 PDF 保持原样，已生成的 PDF 强调其“结构化资产”的属性。

#### B. 笔记生成页 (结果导向)
- **下载区集成**: 在笔记生成完成后的“下载/导出”面板中，新增一个醒目的 **“进入知识卡片模式”** 按钮。
- **即时预览**: 用户无需跳转回列表，点击即可直接在当前上下文开启卡片查看器，实现从“线性笔记”到“结构化卡片”的无缝切换。

#### C. 主页面/应用广场 (功能入口)
- **应用广场**: 在应用广场新增 **“知识卡片库”** 独立磁贴，作为全局卡片管理的总入口。
- **笔记生成下方**: 在“最近生成的笔记”列表下方，新增一个 **“知识点探索”** 模块，以跑马灯或网格形式展示最近提取的 3-5 个核心知识点卡片预览，引导用户点击进入。

### 6.2 导航与返回逻辑
- **全局返回按钮**: 
    - 在 `Detail View`（详情页）和 `Topic Grid`（网格页）的左上角（面包屑左侧）增加一个 **“返回”** 按钮（图标：`ri:arrow-left-s-line`）。
    - **逻辑**: 详情页返回网格页，网格页返回上一级目录，根目录返回知识库列表。
- **悬浮返回 (移动端)**: 移动端在滚动时，右下角提供一个半透明的悬浮返回按钮，确保单手操作的便利性。

### 6.3 全文搜索与高亮增强
- **搜索范围扩展**: 
    - 搜索框不再局限于匹配“目录名”，而是深度检索所有 `base.json` 中的 `topic`、`content`（递归检索所有文本值）以及 `uid`。
- **搜索结果展示**:
    - 搜索结果将区分“目录匹配”和“内容匹配”。
    - 若为内容匹配，搜索建议下方会显示一小段包含关键词的 **内容摘要 (Snippet)**。
- **关键词高亮 (Highlighting)**:
    - **渲染层集成**: 在 `MarkdownRenderer` 中引入高亮逻辑。当从搜索结果进入卡片时，URL 携带 `keyword` 参数。
    - **视觉效果**: 匹配到的文本将使用对应范式颜色的浅色背景并加粗，或者使用标准的 `bg-yellow-200`（莫兰迪黄）进行标记，并支持自动滚动到第一个匹配项。
