# Chat 前端深空极简风格设计方案 (Aurora Edition)

> 目标：打造极致的 iOS 风格 Premium UI，融合 Deep Space Dark Mode、Aurora Gradients、Advanced Glassmorphism 与 Cyberpunk Minimal 元素。

## 1. 核心视觉语言 (Visual Language)

### 1.1 Deep Space Dark Mode (深空暗黑)

- **背景策略**：不再使用纯黑或深灰。采用 **Deep Space Gradient**，模拟宇宙深处的幽暗与微光。
  - Base: `#050505` (接近纯黑的深蓝灰)
  - Ambient: 局部使用径向渐变 (Radial Gradient) 投射微弱的深蓝/紫光晕。
- **Noise Texture (噪点)**：全局叠加一层 3-5% 透明度的噪点纹理，消除数字色块的生硬感，增加胶片质感。

### 1.2 Aurora Gradients & Neon Accents (极光与霓虹)

- **主色调 (Primary)**：放弃单一色值，使用 **Aurora Gradient** (极光渐变)。
  - Cyan: `#00F0FF` (赛博青)
  - Fuchsia: `#FF00FF` (霓虹紫)
  - Violet: `#7000FF` (深紫)
  - 混合应用：主要按钮、激活状态、Logo 使用 Cyan → Fuchsia 的线性或网格渐变。
- **点缀色 (Accents)**：
  - Success: `#00FF9D` (荧光绿)
  - Warning: `#FFD600` (柠檬黄)
  - Error: `#FF2E2E` (亮红)

### 1.3 Advanced Glassmorphism (高级玻璃拟态)

- **多层复合材质**：
  - Layer 1 (Base): `rgba(20, 20, 30, 0.4)` - 低透明度深色底。
  - Layer 2 (Blur): `backdrop-filter: blur(24px) saturate(180%)` - 高模糊 + 高饱和度（关键！让透出的背景色更鲜艳）。
  - Layer 3 (Border): 1px 边框，使用线性渐变 `linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05))`，模拟光照边缘。
  - Layer 4 (Noise): 叠加微弱噪点。
  - Layer 5 (Inner Glow): `box-shadow: inset 0 0 20px rgba(255,255,255,0.02)` - 增加厚度感。

### 1.4 Bento Grid & Fluid Layout (便当盒与流体布局)

- **模块化悬浮**：侧边栏、聊天主窗口、输入框不再是简单的分割，而是独立的“悬浮板块”。
- **间距 (Gap)**：板块之间保留 `16px - 24px` 的透视间距，让背景的深空和光晕透出来。
- **圆角 (Radius)**：统一使用 `24px` (大圆角) 或 `32px` (超大圆角)，符合 iOS 现代审美。

## 2. 详细配色系统 (Color System)

本项目当前已存在浅色/深色两个主题文件：

- `src/styles/themes/light.css`
- `src/styles/themes/dark.css`

本次改造建议采用「**双主题共用一套语义 Token**，每个主题给出不同取值」的方式落地，**不破坏现有 `--btn-* / --input-* / --tab-*` 变量**（保持兼容），同时新增一组更偏“材质/氛围”的 Token 供新 UI 使用。

### 2.1 双主题语义 Token 策略 (Light/Dark Tokens)

**核心原则**

- **同名 Token 表意一致**：例如 `--glass-bg-primary` 在浅色与深色都表示“主玻璃卡背景”，但取值不同。
- **保留旧变量，逐步桥接**：现有组件继续用 `--btn-*` 等变量；新组件/新样式优先用 `--glass-* / --bg-* / --accent-* / --text-*`。
- **浅色也要有“高级玻璃”**：浅色不是简单白底，而是“极光浅雾（Aurora Mist Light）+ 细噪点 + 轻玻璃”。

**Token 分组（两套主题都要覆盖）**

- Background: `--bg-*`（页面背景、渐变、光晕）
- Glass: `--glass-*`（玻璃底色、描边、blur、阴影、内发光）
- Accent: `--accent-*`（cyan/fuchsia、渐变、glow）
- Text: `--text-*`（主/次/弱）
- Motion(可选): `--motion-*`（hover/press 时长、曲线）

### 2.2 深色主题（Deep Space Dark）建议变量

建议在 `src/styles/themes/dark.css` 中新增/补充以下变量：

```css
:root[data-theme='dark'] {
  /* --- Backgrounds --- */
  --bg-deep-space: #050505;
  --bg-gradient-main: radial-gradient(circle at 0% 0%, #1a103c 0%, #050505 40%, #050505 100%);

  /* --- Glass Materials --- */
  --glass-bg-primary: rgba(30, 30, 40, 0.6);
  --glass-bg-secondary: rgba(20, 20, 30, 0.4);
  --glass-border: rgba(255, 255, 255, 0.08);
  --glass-border-highlight: rgba(255, 255, 255, 0.15);
  --glass-blur: blur(20px) saturate(180%);
  --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.36);

  /* --- Aurora Accents --- */
  --accent-cyan: #00f0ff;
  --accent-fuchsia: #ff00ff;
  --accent-gradient: linear-gradient(135deg, #00f0ff 0%, #7000ff 50%, #ff00ff 100%);
  --accent-glow: 0 0 20px rgba(0, 240, 255, 0.3);

  /* --- Text --- */
  --text-primary: rgba(255, 255, 255, 0.92);
  --text-secondary: rgba(255, 255, 255, 0.6);
  --text-tertiary: rgba(255, 255, 255, 0.3);
}
```

### 2.3 浅色主题（Aurora Mist Light）建议变量

浅色主题的目标：**干净、通透、冷感**，但仍保留极光点缀与玻璃层次（避免“网页白板感”）。

建议在 `src/styles/themes/light.css` 中新增/补充：

```css
:root,
:root[data-theme='light'] {
  /* --- Backgrounds --- */
  --bg-deep-space: #f6f7fb; /* 作为浅色基底命名保持一致，值是浅雾底 */
  --bg-gradient-main:
    radial-gradient(
      circle at 0% 0%,
      rgba(0, 240, 255, 0.14) 0%,
      rgba(112, 0, 255, 0.1) 28%,
      rgba(246, 247, 251, 1) 60%
    ),
    radial-gradient(circle at 100% 10%, rgba(255, 0, 255, 0.1) 0%, rgba(246, 247, 251, 1) 55%);

  /* --- Glass Materials (Light) --- */
  --glass-bg-primary: rgba(255, 255, 255, 0.64);
  --glass-bg-secondary: rgba(255, 255, 255, 0.46);
  --glass-border: rgba(15, 23, 42, 0.12);
  --glass-border-highlight: rgba(255, 255, 255, 0.9);
  --glass-blur: blur(18px) saturate(165%);
  --glass-shadow: 0 14px 40px rgba(16, 24, 40, 0.16), 0 1px 0 rgba(255, 255, 255, 0.35);
  --glass-inner-glow:
    inset 0 1px 0 rgba(255, 255, 255, 0.55), inset 0 0 24px rgba(255, 255, 255, 0.22);

  /* --- Aurora Accents (同色系但更克制) --- */
  --accent-cyan: #00cbe0;
  --accent-fuchsia: #d400d4;
  --accent-gradient: linear-gradient(135deg, #00cbe0 0%, #6a4bff 52%, #d400d4 100%);
  --accent-glow: 0 0 18px rgba(0, 203, 224, 0.22);

  /* --- Text (Light) --- */
  --text-primary: rgba(15, 23, 42, 0.92);
  --text-secondary: rgba(15, 23, 42, 0.62);
  --text-tertiary: rgba(15, 23, 42, 0.38);
}
```

### 2.4 与现有主题变量的兼容/桥接 (保持不破坏)

你当前主题里已有：

- Button: `--btn-bg-primary` / `--btn-bg-secondary` / `--btn-bg-ghost` / `--btn-bg-danger` ...
- Input: `--input-bg` / `--input-border` / `--input-border-focus` ...
- Tab: 浅色 `--tab-*`，深色 `--tab-*-dark`

为了让新风格“先全局生效，再逐步替换组件”，建议采用两条线并行：

- **线 A（不动旧组件）**：保留原 `--btn-* / --input-* / --tab-*`；仅在必要时把它们的取值调成更贴近 Aurora（例如深色主按钮更偏霓虹、浅色更冷冽）。
- **线 B（新风格专用）**：新增 `--bg-* / --glass-* / --accent-* / --text-*` 并先用在布局容器、卡片、输入胶囊、气泡等“新视觉主舞台”。

可选桥接建议（逐步启用，不强制）：

- 让 `--btn-bg-primary` 在两主题里都指向 `--accent-gradient` 的纯色近似或直接使用渐变按钮样式（实现层面用 class，而不是强行把 CSS 变量做成渐变）。
- 让 `--input-border-focus` 跟随 `--accent-cyan`（深色更亮，浅色更克制）。
- Tab 在深色目前使用 `--tab-*-dark`，建议后续统一命名为 `--tab-*`（但这属于“清理阶段”，避免一次性大改）。

## 3. 组件样式规范 (Component Specs)

### 3.1 聊天气泡 (Chat Bubbles)

- **User**:
  - 背景：`--accent-gradient` (极光渐变)。
  - 文字：白色，加粗。
  - 形状：`border-radius: 20px 20px 4px 20px`。
  - 阴影：`--accent-glow`。
- **AI**:
  - 背景：`--glass-bg-secondary`。
  - 边框：1px solid `--glass-border`。
  - 文字：`--text-primary`。
  - 形状：`border-radius: 20px 20px 20px 4px`。

### 3.2 输入框 (Input Capsule)

- **形态**：完全悬浮的胶囊形状 (Capsule)，底部留空。
- **材质**：Advanced Glassmorphism。
- **交互**：Focus 时，边框发光 (`--accent-cyan`)，背景透明度略微降低。
- **按钮**：发送按钮使用圆形图标，背景为 Neon Gradient。

### 3.3 侧边栏 (Sidebar)

- **形态**：独立的左侧玻璃板，与主窗口分离。
- **列表项**：
  - Default: 透明。
  - Hover: 轻微白色半透明 (`rgba(255,255,255,0.05)`).
  - Active: 玻璃拟态高亮 + 左侧 Neon 光条指示器。

### 3.4 按钮 (Buttons)

- **Primary**: 极光渐变背景 + 黑色文字 (高对比度) 或 白色文字 + 强发光。
- **Ghost**: 仅文字，Hover 时出现极光色文字。
- **Glass**: 半透明背景 + 模糊 + 边框。

## 4. 实施步骤 (Implementation Plan)

1. **资源准备**:
   - 生成/下载一张高质量的 Noise Texture (png/svg)。
   - 准备 CSS 变量集。

2. **双主题 Token 落地（`themes/light.css` + `themes/dark.css`）**:

- 新增/补齐 `--bg-* / --glass-* / --accent-* / --text-*`（两套主题都补）。
- 保留并微调现有 `--btn-* / --input-* / --tab-*`（以“不破坏”为前提）。
- **验收**：切换浅/深色时，文本对比度、按钮/输入焦点色均合理；旧页面无明显样式错乱。

3. **全局样式重置 (`global.less` / `index.css`)**:
   - 设置 `body` 背景为 Deep Space Gradient。
   - 添加全局 Noise 伪元素覆盖。

- 定义 `.glass` / `.glass-card` / `.neon-border` 等 Utility Class（同一套 class 在浅/深主题下由变量自动变色）。
- **验收**：浅/深主题下背景渐变与噪点叠加一致；玻璃卡在两主题下都“通透但可读”。

4. **组件改造（先骨架后细节，浅/深同时适配）**:
   - **Layout**: 修改 `chat.vue`，引入 Bento Grid 间距，让侧边栏和主内容区悬浮。
   - **验收**：浅/深主题下三块区域（侧栏/主聊天/工具区）层级清晰，间距一致。
   - **Sider**: 去除默认背景，应用玻璃材质。
   - **验收**：选中态/hover 态在浅/深主题下均清晰；折叠态不抖动。
   - **ChatBase**:
     - 消息列表背景透明。
     - 气泡样式重写。
     - 输入框区域重写为悬浮胶囊。
   - **验收**：用户/AI 气泡在浅/深主题都可读，代码块不刺眼；输入聚焦有轻微霓虹但不晃眼。

5. **动效微调（两主题同标准）**:
   - 添加 Hover 时的光晕流动效果。
   - 页面加载时的淡入 + 上浮动画。

## 5. 分步改造计划 (Step-by-Step Roadmap)

- **阶段 0｜确认基线**
  - 梳理现有 `chat` 端依赖、主题切换逻辑，记录需保留的交互与状态管理，避免 UI 优化误伤功能。

### 阶段 0 输出：现状基线盘点（已完成）

#### 0.1 主题系统现状（必须保持一致）

- **CSS 入口**：`chat/src/main.ts` 引入 `github-markdown.less`、`global.less`、`index.css`；`index.css` 再引入 `themes/light.css` / `themes/dark.css`。
- **主题生效机制**（当前同时存在两条链路）：
  - **链路 A（启动时）**：`chat/src/main.ts` 内 `detectSystemTheme()` 读取 `localStorage.theme` 或系统 `prefers-color-scheme`，设置：
    - `document.documentElement.classList.toggle('dark', theme === 'dark')`
    - `document.documentElement.dataset.theme = theme`
  - **链路 B（初始化补偿）**：`chat/src/hooks/useTheme.ts` 的 `init()` 会再次读取 `localStorage.theme`，并重复设置 `data-theme` 与 `dark` class。
  - **链路 C（用户切换）**：顶部栏主题按钮调用 `appStore.setTheme(mode)`（见 `chat/src/views/chat/components/Header/index.vue`），目前只负责切换 `documentElement.classList`（`dark`），并写入 `localStorage.theme`、同步 `appStore.theme`。

**阶段 0 结论（设计落地约束）**

- 我们的双主题改造必须同时兼容：
  - Tailwind 的 `dark:`（依赖 `html.dark` class）
  - CSS 变量主题（依赖 `html[data-theme='light'|'dark']`）
- UI 改造期间，任何样式都不要假设只存在其中一种机制；
- 组件里若出现 `dark:` 类，必须保证对应的 CSS 变量也能在两主题下正常取值。

#### 0.2 关键页面/组件骨架（UI 改造落点）

- 页面壳：`chat/src/views/chat/chat.vue`
  - 负责移动端/桌面端容器差异、侧栏折叠 padding（`pl-[260px]`）。
  - `provide('createNewChatGroup', ...)` 给子组件新建对话用。
- 主编排：`chat/src/views/chat/chatBase.vue`
  - 核心对话流、流式输出、工作流内容写入（`useGlobalStore.updateWorkflowContentLast` 等）。
  - 注入/提供：`createNewChatGroup`、`showAppConfigModal`、`tryParseJson`、`onConversation` 等（用于 App 执行/表单弹窗）。
- 顶部栏：`chat/src/views/chat/components/Header/index.vue`
  - 主题切换按钮：`checkMode()` → `appStore.setTheme(mode)`。
  - 模型切换/设置入口：`useGlobalStore.updateSettingsDialog(...)`、`updateMobileSettingsDialog(...)`。
- 输入区：`chat/src/views/chat/components/Footer/index.vue`
  - 多行输入自动高度、展开/收起、文件/图片上传、快捷操作按钮、发送状态（`buttonDisabled` 依赖 `isStreamIn` + prompt）。
- 消息卡：`chat/src/views/chat/components/Message/index.vue`
  - 用户/AI 消息分支、复制/重新生成/删除等交互；
  - 预览器状态会影响头像/工具按钮显示（`isPreviewerVisible`）。
- 侧栏：`chat/src/views/chat/components/sider/index.vue`
  - 负责侧栏固定定位、折叠/移动端安全区、积分动画、登录入口、打开设置等。

#### 0.3 不可破坏清单（UI 只能换皮，不改行为）

- **主题切换**：Header 的“亮/暗”按钮必须继续即时生效；`dark:` 与 `data-theme` 两套必须同时正确。
- **侧栏折叠/移动端抽屉**：`appStore.siderCollapsed` 控制的位移/宽度逻辑不能变；移动端 `env(safe-area-inset-bottom)` 必须保留。
- **输入区行为**：
  - 自动高度（最多 8 行）、展开模式 `60vh`、展开按钮显示逻辑必须保持；
  - 上传（文件/图片）与拖拽态提示不丢失；
  - `isStreamIn` 时发送按钮禁用逻辑保持。
- **对话流与流式输出**：
  - `chatBase.vue` 流式渲染/缓冲/速度档位/滚动到底部逻辑不修改；
  - 工作流内容清空与追加（`clearWorkflowContent` / `updateWorkflowContentLast`）保持。
- **预览器互斥显示**：预览器开启时，某些头像/工具按钮会隐藏（`isPreviewerVisible`），该逻辑不能被样式覆盖导致不可点击。
- **注入链路**：`provide/inject` 的 key 不能改名（`createNewChatGroup`、`onOpenImagePreviewer`、`showAppConfigModal`、`tryParseJson` 等）。

#### 0.4 阶段 0 验收清单（改 UI 前先确认）

- 切换主题（浅/深）后：
  - `html` 同时满足：`class` 含/不含 `dark`；`data-theme` 为 `light|dark`；
  - `themes/light.css` 与 `themes/dark.css` 中的旧变量（`--btn-* / --input-* / --tab-*`）仍被正确读取。
- 侧栏：折叠/展开、移动端抽屉、顶部按钮可用。
- 输入区：自动高度、展开/收起、发送禁用、上传入口可用。
- 消息：复制/重新生成/删除按钮可用；预览器开启时隐藏规则仍正确。

> 备注：目前 `appStore.setTheme()` 只切换 `html.dark` class，并未同步 `html.dataset.theme`；而启动阶段会设置 `data-theme`。后续进入阶段 1/2 时，若出现“dark class 与 data-theme 不一致”的视觉问题，需要在不改交互语义的前提下统一这两者的同步方式（属于实现细节，不在阶段 0 动）。

> 更新（已修复）：`appStore.setTheme()` 现已同时同步 `html.dataset.theme` 与 `html.dark` class（并兼容 `auto`），用于避免“浅色主题下弹窗/对话框仍走暗色样式导致全黑”的问题。

- **阶段 1｜基础资源与主题变量打底**
  - 在 `src/styles/themes/light.css`、`src/styles/themes/dark.css`、`global.less`、`index.css` 增补新的语义 Token、噪声纹理、通用玻璃/渐变工具类。
  - 引入噪声纹理资源（深浅两版），准备 Aurora 渐变相关工具类。
  - **验收**：浅/深主题切换时背景/文本对比度稳定；旧按钮/输入/Tab 仍正常。

### 阶段 1 输出：主题变量与氛围层打底（已完成）

#### 1.1 已落地的文件改动

- 新增噪点资源：`chat/public/noise.svg`（通过 `body::before` 全局叠加，不拦截点击）。
- 新增/补齐主题语义 Token：
  - `chat/src/styles/themes/light.css`：新增 `--bg-* / --glass-* / --accent-* / --text-* / --noise-*`（不改旧变量取值）。
  - `chat/src/styles/themes/dark.css`：同上；并额外支持 `:root.dark` 选择器（与 Tailwind `dark:` 保持一致）。
- 全局背景与噪点覆盖：`chat/src/styles/global.less`
  - `body` 背景改为使用 `--bg-deep-space` + `--bg-gradient-main`
  - `body::before` 叠加 `noise.svg`，透明度由 `--noise-opacity` 控制
  - `#app` 提升到噪点层之上（`z-index: 1`）
- 新增可复用工具类（未改组件结构，仅提供能力）：`chat/src/styles/index.css`
  - `.glass` / `.glass-card`（玻璃材质）
  - `.aurora-border`（极光渐变描边）
  - `.aurora-text` / `.neon-ring`（极光文字/光晕）

#### 1.2 你需要检查什么（阶段 1 验收清单）

1. **主题切换一致性（最重要）**

- 在聊天页点击 Header 的亮/暗切换：
  - 背景应从“浅雾极光”↔“深空渐变”明显变化；噪点强度轻微变化（浅色更轻，深色略强）。
  - 按钮、输入框、Tab 的旧样式不应出现“突然变白/变黑/读不清”。

- 可选快速自检（控制台）：
  - 浅色时应为：`document.documentElement.classList.contains('dark') === false` 且 `document.documentElement.dataset.theme === 'light'`
  - 深色时应为：`... === true` 且 `... === 'dark'`

2. **噪点层不影响交互**

- 鼠标点击/拖拽上传/选择文本/滚动：不应出现点不到、无法选中、hover 失效等现象（因为噪点层 `pointer-events: none`）。

3. **可读性与对比度**

- 浅色主题：页面不应像“白板”，文字仍清晰；深色主题：不是纯黑一坨，层次可见。

4. **性能与模糊风险（观察项）**

- 在低配设备或移动端滚动时，如果发现卡顿：先记录场景与页面元素；阶段 7 再做 blur/阴影降级策略。

> 说明：阶段 1 仅完成“变量/氛围层/工具类”的地基，不修改任何业务逻辑与组件结构；后续阶段会在组件上逐步套用 `.glass-card / .aurora-border` 等能力。

- **阶段 2｜全局背景与框架结构**
  - 改造 `views/chat/chat.vue` 外层：深空渐变背景、全局噪声覆盖、Bento Grid 栅格间距。
  - 调整根容器圆角、阴影、内边距，让侧栏与主内容呈悬浮效果。
  - **验收**：浅色不刺眼（白不泛光）、深色不糊；移动端滚动/吸底不被背景伪元素影响。

#### 2.1 已落地的文件改动（阶段 2）

- `chat/src/views/chat/chat.vue`
  - 桌面端增加外层留白（`p-3 md:p-4`）与容器圆角/描边（Token：`--glass-border`）。
  - 保持移动端全屏（无额外留白），不影响侧栏折叠逻辑。
- `chat/src/views/chat/chatBase.vue`
  - 主聊天容器套用 `.glass-card`，形成“悬浮玻璃面板”基底（含对话背景图时仍可透出）。
- `chat/src/views/chat/components/sider/index.vue`
  - 侧栏桌面端增加 inset（`md:top-4/left-4/bottom-4`）并套用 `.glass-card`，形成 Bento 双面板外观。
  - 移动端抽屉/遮罩交互保持不变。

#### 2.2 你需要检查什么（阶段 2 验收清单）

1. **桌面端（≥ md）**

- 侧栏与主内容应呈“两个独立悬浮面板”，四周留白一致、圆角一致。
- 展开/折叠侧栏时，主内容不应被遮挡（`pl-[260px]` 位移逻辑仍生效）。

2. **移动端**

- 聊天页仍为全屏（不出现多余白边），输入区吸底/滚动正常。
- 侧栏抽屉滑入/遮罩点击关闭正常。

3. **背景与可读性**

- 有对话背景图时：Header/消息区可读，玻璃面板不应“发灰/发黑到看不清”。
- **阶段 3｜侧栏（会话/App 列表）玻璃化**
  - 处理 `components/sider` 相关样式：玻璃材质、选中态霓虹描边、Hover 无妨碍交互。
  - 确认折叠/移动端抽屉样式在新主题下的表现。
  - **验收**：选中态在浅/深主题都明确；hover 不抢戏；列表可读性达标。

#### 3.1 已落地的文件改动（阶段 3）

- `chat/src/views/chat/components/sider/index.vue`
  - 去除侧栏顶部区域的固定暗色底（`dark:bg-gray-900`），统一依赖玻璃面板；标题文字改为语义 Token 文本色。
- `chat/src/views/chat/components/sider/ListItem.vue`
  - 会话列表项：hover 使用 `--glass-bg-secondary` 作为玻璃高亮；active 使用 `.aurora-border + .neon-ring`（极光描边 + 霓虹光晕）并统一文本色为 `--text-*`。
- `chat/src/views/chat/components/sider/List.vue`
  - “我的应用”列表项/应用广场入口：统一为玻璃 hover（变量驱动），移除硬编码白/灰背景与错误的 class 字符串。
  - 折叠按钮与清空按钮：文本色改为 `--text-tertiary/--text-primary` 的 hover 过渡。
- `chat/src/views/chat/components/sider/Plugin.vue`
  - 插件卡片：改为玻璃卡片；选中态同样使用 `.aurora-border + .neon-ring`。

#### 3.2 你需要检查什么（阶段 3 验收清单）

1. **选中态足够明确（浅/深主题都要看）**

- 当前会话：列表项应出现“极光描边 + 轻霓虹光晕”，文字更清晰。
- 选中态不应只靠颜色深浅变化（避免浅色下不明显）。

2. **Hover 不抢戏但有反馈**

- 悬停任意会话/应用/插件卡片：出现轻微玻璃高亮（不是整块纯白/纯黑）。

3. **折叠/抽屉行为不受影响**

- 桌面端：折叠按钮可用，折叠/展开动画与主内容 `pl-[260px]` 位移逻辑正常。
- 移动端：侧栏抽屉滑入/遮罩点击关闭正常，列表滚动/点击不受玻璃层影响。
- **阶段 4｜主聊天流与消息气泡**
  - 在 `views/chat/chatBase.vue` 中重绘用户 / AI 气泡、时间分隔、头像以及代码块磨砂卡片。
  - 保留 Markdown、代码高亮、消息状态等现有功能。
  - **验收**：浅色下用户渐变气泡不“脏”、不晃眼；深色下 AI 气泡层次明显；代码块对比度舒适。

#### 4.1 已落地的文件改动（阶段 4）

- `chat/src/styles/index.css`
  - 新增 `.bubble-ai/.bubble-user`：AI 气泡使用玻璃次层背景；用户气泡使用“单色调渐变（基于 `--accent-cyan`）+ 玻璃底 + 描边”（更清爽、不做霓虹多色）。
  - 新增/统一 `.code-block-wrapper/.code-block-header`：代码块外层与标题条改为磨砂玻璃卡（Token 驱动），避免硬编码浅/深底色。
- `chat/src/styles/themes/light.css` / `chat/src/styles/themes/dark.css`
  - 新增 `--accent-cyan-rgb`（由现有 `--accent-cyan` 拆分得到），用于“单色调渐变”而不引入新颜色。
- `chat/src/views/chat/components/Message/Text/index.vue`
  - AI 消息：Markdown 渲染区域外包一层 `.bubble-ai`（不改 MarkdownIt/hljs/katex 逻辑）。
  - 用户消息：展示态与编辑态外容器改用 `.bubble-user`（不改编辑/发送/取消等逻辑）。
  - 代码块：`highlightBlock()` 的 wrapper 增加 `code-block-wrapper` class，移除硬编码的浅/深背景与灰色边框，交由 Token/全局样式控制。
  - 主题注入样式：保留 `.hljs` 透明背景覆盖，避免与玻璃代码卡冲突。
  - 小修：AI 空内容加载时的等待点动画改用 `opacity-80`（避免 Tailwind 对任意颜色的 `/80` 透明度写法不生效导致不可见）。

#### 4.2 你需要检查什么（阶段 4 验收清单）

1. **AI / 用户气泡层次（浅/深主题都要看）**

- AI：气泡应为“磨砂玻璃”，文字可读（不应出现整块纯黑/纯白）。
- 用户：气泡为“清爽单色调渐变 + 玻璃底”（不使用霓虹多色渐变），在浅色不脏不灰；在深色仍有层次但不刺眼，文字保持清晰。

2. **代码块磨砂卡 + 复制按钮可用**

- 代码块标题条与内容区是同一张玻璃卡的层次（没有突兀的纯白/纯黑底）。
- 点击复制：按钮仍可点、反馈仍正常；长代码横向滚动正常。

3. **消息布局不回归**

- 桌面端：气泡宽度自适应，不应强制铺满整行；长文本/长链接不会溢出。
- 移动端：用户消息右对齐逻辑不变（`pl-20/pl-28` 仍生效），编辑态 textarea 自动增高仍正常。

4. **编辑态可读性**

- 用户消息编辑态 textarea：文字与 placeholder 在浅/深主题都清晰（不应出现“白字配浅底/黑字配深底”的对比问题）。
- **阶段 5｜输入区与工具栏胶囊化**
  - 改写底部输入区布局与按钮样式，实现悬浮玻璃胶囊、Aurora 发送按钮。
  - 确保快捷标签、附件入口、消息状态提示兼容新结构。
  - **验收**：浅/深主题下输入光晕强度合适；按钮可点击区域符合移动端；键盘弹出不遮挡。

#### 5.1 已落地的文件改动（阶段 5）

- `chat/src/styles/index.css`
  - 新增 `.input-capsule`：底部输入区外壳使用玻璃材质（Token：`--glass-bg-* / --glass-border / --glass-blur / --glass-shadow`）。
  - 新增 `.input-capsule:focus-within`：输入聚焦时提升边框高亮并叠加 `--accent-glow`，形成轻极光光晕。
  - 新增 `.input-capsule--drag / .input-capsule--dragover`：拖拽上传进入/悬停时的视觉反馈（高亮描边 + 背景层次变化）。
  - 新增 `.footer-pill`：为底部工具按钮提供玻璃 pill 覆盖样式（与现有 `.btn-pill` 兼容）。
  - 调整 `.footer-pill.btn-pill-active`：激活态改为 **Aurora 渐变 + glow（与发送按钮同款配色）**，并去掉旧的 1px border，避免浅/深主题下“高亮不清楚/出现发丝线”。
- `chat/src/views/chat/components/Footer/index.vue`
  - 输入区外壳改用 `.input-capsule`，并按原有拖拽状态绑定 `.input-capsule--drag / --dragover`（不改上传/拖拽逻辑）。
  - 输入框 textarea 改为语义色：`text-[color:var(--text-primary)]`、`placeholder:text-[color:var(--text-tertiary)]`，背景保持透明。
  - 底部工具按钮追加 `.footer-pill`（上传、展开、推理、搜索、图表），仅换皮不改交互/状态。
  - 发送按钮继续使用 `.btn-send`；禁用态仅通过 class 叠加视觉弱化（不改 `buttonDisabled` 逻辑）。
- `chat/tailwind.config.js`
  - `.btn-send` 改为 Token 驱动 Aurora：`backgroundImage: var(--accent-gradient)` + `boxShadow: 1px ring + var(--accent-glow)`；并显式 `outline: none` / 渐变居中裁剪，修复放大时左侧/上侧出现的“发丝线”。禁用态回退为玻璃底并降低对比度。

#### 5.2 你需要检查什么（阶段 5 验收清单）

1. **输入胶囊材质与聚焦光晕（浅/深主题都要看）**

- 点击输入框后：胶囊边框应更清晰，且出现克制的 `--accent-glow` 光晕；文字/placeholder 对比度正确。
- 失焦后：光晕消失、回到默认玻璃态，不应“常亮”。

2. **拖拽上传反馈不遮挡交互**

- 把文件拖到页面/输入区：胶囊出现高亮反馈（`--drag/--dragover`），提示层可见。
- 松开上传：原有上传与预览流程正常；拖拽覆盖层不应导致按钮点不到（噪点层与覆盖层不拦截不该拦截的点击）。

3. **工具 pills 可读且激活态明确**

- Hover：出现轻微玻璃高亮（不是纯白/纯黑块）。
- 激活（推理/搜索/图表）：`.btn-pill-active` + `.footer-pill` 的高亮与光晕在浅/深主题都能分辨。

4. **发送/停止与禁用态不回归**

- 禁用发送（空输入且无附件 / 流式中）：按钮变为“玻璃禁用态”（不再是极光渐变），且不可点击。
- 流式生成中：停止按钮仍可用；按钮区域不挤压、不抖动。

5. **移动端可点击区与键盘遮挡**

- 移动端：发送/停止按钮点击区够大（`h-8 w-8` 生效），不易误触。
- 键盘弹出：输入区仍吸底可用，文本不会被遮挡；展开/收起输入框不出现布局跳动。
- **阶段 6｜插件/工具面板与弹窗统一**
  - 调整 `AppList`、`PresetHints`、`Footer` 等模块，套用 Bento 卡与霓虹描边。
  - 统一模态/抽屉（`SettingsDialog` 等）的暗色玻璃风格。
  - **验收**：浅色模态不灰不脏；深色模态不黑成一坨；遮罩层级正确。

#### 6.1 已落地的文件改动（阶段 6）

- `chat/tailwind.config.js`
  - 调整 `.btn-pill`：改为 Token 驱动的玻璃 pill（`--glass-bg-* / --glass-border / --glass-blur`），hover 提升边框高亮与层次。
  - 调整 `.btn-pill-active`：改为 **Aurora 渐变 + glow**（与阶段 5 的视觉语言一致），供 AppList/弹窗按钮等复用。
- `chat/src/views/chat/chatBase.vue`
  - AppList 容器移除 `bg-white dark:bg-gray-900` 硬编码底色，避免覆盖主容器玻璃背景（仅换皮，不改逻辑）。
- `chat/src/views/chat/components/AppList/index.vue`
  - AppList 外层改为透明背景；应用卡片改为 `.glass` 磨砂卡；标题/描述/标签文字改用 `--text-*`。
  - 应用分类标签（卡片内 catName）改为玻璃 tag（Token 驱动），避免浅/深主题下出现突兀纯白/纯黑块。
- `chat/src/views/chat/components/PresetHints/index.vue`
  - 预设提示卡标题文字改用 `--text-secondary`，与玻璃按钮/背景一致。
- `chat/src/components/SettingsDialog.vue`
  - 桌面设置弹窗容器改为 `glass-card + aurora-border`；左右分栏容器改为玻璃材质。
  - Tabs 选中态统一为 `aurora-border + neon-ring`，非选中态使用玻璃 hover 与语义文本色。
- `chat/src/components/MobileSettingsDialog.vue`
  - 移动端设置改为全屏玻璃卡（`rounded-none`），标题栏/分割线/hover 背景统一改为 Token。
- `chat/src/components/Dialog/Confirm.vue`
  - Confirm 对话框改为玻璃卡 + Aurora 描边；确认按钮复用 `.btn-pill-active`。
- `chat/src/components/HtmlDialog.vue`
  - HTML 弹窗整体改为全屏玻璃卡；按钮与边框改为玻璃/Token；遮罩增加轻 blur。
- `chat/src/components/Settings/AccountManagement.vue`
  - 账户管理页的各视图卡片（个人信息/账户安全/修改密码/绑定手机号/实名认证/绑定微信）统一为 `.glass` + `--text-*` + `--glass-border`（仅换皮，不改逻辑）。
- `chat/src/components/Settings/MemberCenter.vue`
  - 会员中心页的卡片容器与套餐选中态统一为玻璃 + Aurora（选中态 `aurora-border + neon-ring`），文本色改用 `--text-*`。
- `chat/src/components/Settings/NoticeDialog.vue`
  - 网站公告页卡片统一为玻璃；`MdPreview` 背景改为透明以跟随外层玻璃。

#### 6.2 你需要检查什么（阶段 6 验收清单）

1. **AppList 面板一致性（浅/深主题都要看）**

- 顶部分类 pills：默认是玻璃态，激活态为 Aurora 渐变 + glow，浅/深都明显。
- 应用卡片：背景为磨砂玻璃，不应出现整块纯白/纯黑；hover 有轻层次（不抢戏）。
- 卡片内分类 tag：可读、可点，hover 有玻璃反馈；会员图标仍正常显示。

2. **桌面设置弹窗（SettingsDialog）**

- 弹窗材质：浅色不发灰发脏；深色不糊成一坨；标题与内容区对比度正确。
- Tabs：选中态有 Aurora 描边 + 轻光晕；hover 有玻璃高亮；切换 tab 内容不闪烁/不丢状态（`keep-alive` 仍生效）。
- 内容区：滚动/点击/关闭按钮/退出登录确认弹窗行为不回归。

3. **移动端设置（MobileSettingsDialog）**

- 全屏容器：背景为玻璃材质；顶部返回/关闭按钮可见且 hover/点击反馈正常。
- 主菜单列表：分割线不突兀；列表项 hover 高亮一致；进入二级页面与返回逻辑不受影响。

4. **常用弹窗（Confirm / HtmlDialog）**

- Confirm：标题/正文可读；确认按钮为 Aurora 高亮；遮罩层点击仍可取消。
- HtmlDialog：编辑/预览区域边框不刺眼；取消/复制/分享按钮样式统一且功能正常；关闭后内容同步不回归。

5. **性能与层级**

- 移动端：全屏玻璃 blur/阴影不应明显卡顿。
- 遮罩/弹窗层级：不应被主界面噪点/背景遮挡；也不应出现点击穿透。

6. **设置子页卡片（账户管理 / 会员中心 / 网站公告）**

- 卡片背景/边框：不再出现 `bg-white/dark:bg-gray-*` 旧底色；浅色不灰、深色不闷。
- 标题与分割线：标题为 `--text-primary`，分割线为 `--glass-border`。
- 会员中心套餐：选中态为 Aurora 描边 + 轻光晕，未选中态为玻璃边框；点击逻辑不变。
- **阶段 7｜动效与微交互**
  - 加入页面初载、Hover、点击的光晕/浮动动画，以及列表切换过渡。
  - 审查性能，必要时为移动端降级 blur/阴影。
  - **验收**：动效不晕、不拖影；低端设备可接受；滚动不卡顿。

### 阶段 7 输出：动效与微交互（已完成）

#### 7.1 已落地的文件改动（阶段 7）

- `chat/src/styles/themes/light.css` / `chat/src/styles/themes/dark.css`
  - 新增 motion token：`--motion-fast/--motion-normal/--motion-slow/--motion-ease`（两主题同语义）。
- `chat/src/styles/index.css`
  - 玻璃材质统一过渡：`.glass/.glass-card/.aurora-border` 增加基于 motion token 的 transition。
  - 新增可复用微交互类：`.interactive-surface`（hover 提亮边框 + 轻内高光；active 轻微下沉）。
  - 新增入场动效类：`.motion-fade-up`（克制的淡入+上浮）。
  - 性能/无障碍：
    - `max-width: 768px` 下降低 blur 强度（减少移动端压力）。
    - `prefers-reduced-motion: reduce` 下禁用动画/过渡。
- `chat/src/styles/global.less`
  - `#app` 增加首屏淡入（同样尊重 `prefers-reduced-motion`）。

#### 7.2 你需要检查什么（阶段 7 验收清单）

1. **首屏入场（浅/深主题都看）**

- 首次打开页面：整体有轻微淡入/上浮（不应晕、不应拖影）。
- 如果你系统开启了“减少动态效果”：入场动画应自动消失。

2. **Hover/按下反馈**

- 玻璃卡、按钮、可点击卡片：hover 时边框更清晰、阴影层次略增强；按下时轻微下沉。
- 动效强度克制，不应导致布局抖动或点击区域漂移。

3. **移动端性能（重点）**

- 手机/窄屏：滚动、打开设置弹窗、切换三页（账户管理/会员中心/网站公告）不应明显卡顿。
- 玻璃 blur 强度在移动端应更轻（视觉仍是玻璃，但更稳）。

4. **无障碍/系统偏好**

- `prefers-reduced-motion: reduce`：应禁用淡入与 hover 过渡（至少不出现明显动画）。

- **阶段 8｜注册/登录界面风格统一**
  - 目标：把登录/注册相关弹窗从“白底/灰底 + 纯黑遮罩”统一到当前 Aurora + Glass 体系（仅换皮，不改任何业务逻辑/校验/接口）。

### 阶段 8 输出：注册/登录界面风格统一（已完成）

#### 8.1 已落地的文件改动（阶段 8）

- `chat/src/components/Login/Login.vue`
  - 遮罩层改为 Token 化（`--overlay-mask`）+ 轻 `backdrop-blur`。
  - 弹窗外壳统一为 `glass-card + aurora-border`，文本色改为 `--text-*`。
  - Tab 容器去除硬编码深色底，改为玻璃背景/描边（Token 驱动）。
- `chat/src/components/Login/Email.vue`
  - label/协议区/链接文案 Token 化（`--text-* / --accent-*`）。
  - 输入框在本组件内覆写为玻璃风格（避免全局 `.input` 仍为白底导致不一致）。
  - “发送验证码”按钮改用 `btn-pill + footer-pill`（玻璃 pill 体系）。
  - ✅ 验证码输入框与“发送验证码”按钮改为垂直居中对齐（视觉中线一致）。
  - 提交按钮改为 Aurora 渐变背景（Token 驱动），禁用态保持原逻辑。
- `chat/src/components/Login/Wechat.vue`
  - 二维码卡片/骨架改为玻璃材质与 Token 描边；loading 圈使用 `--accent-cyan`。
  - 文案与协议区 Token 化。
- `chat/src/components/Login/SliderCaptcha.vue`
  - 弹窗外壳使用 `glass-card + aurora-border`；遮罩改为 Token 化并增加轻 blur。
  - 滑轨/滑块关键色改用 `--accent-cyan-rgb` 与玻璃 Token（不改验证逻辑）。
- `chat/src/styles/themes/light.css` / `chat/src/styles/themes/dark.css`
  - 新增 `--overlay-mask`，用于登录弹窗与滑块验证码遮罩层统一。
  - ✅ 仅深色主题调整 `--accent-gradient / --accent-glow`，优化注册/登录霓虹渐变观感（浅色不改）。

#### 8.2 你需要检查什么（阶段 8 验收清单）

1. **浅/深主题一致性**

- 打开登录弹窗：外壳应为玻璃卡 + Aurora 描边；遮罩不应“压黑”浅色主题。
- 切换主题后：登录弹窗仍保持同一套玻璃/文本层级（不出现白底/全黑回归）。

2. **三种登录方式流程不回归（关键）**

- 微信登录：二维码正常刷新；扫码后可登录；倒计时/轮询逻辑不变。
- 验证码登录：点击“发送验证码”能正常弹出滑块验证码；验证通过后能发送验证码；倒计时显示正常。
- 密码登录：提交按钮禁用条件、登录成功/失败提示与跳转行为不变。

3. **滑块验证码可用性**

- 弹窗出现/关闭正常，不会被其他层遮挡；拖动顺滑；成功/失败提示可见。
- 关闭后页面不应无法滚动（`vue-puzzle-overflow` 仍能正确移除）。

4. **移动端表现**

- `98vw` 宽度下内容不溢出；输入框、按钮可点；遮罩层不影响点击与输入。

- **阶段 9｜响应式校准与 QA**
  - 目标：针对 1440 / 1200 / 1024 / 768 / 480 断点逐个校准，修复溢出/错位；补齐基础可访问性与对比度，并清理残留硬编码样式冲突（仅换皮，不改任何业务逻辑）。

### 阶段 9 输出：响应式校准与 QA（已完成）

#### 9.1 已落地的文件改动（阶段 9）

- `chat/src/components/Dialog/Confirm.vue`
  - 对话框宽度改为 `w-[92vw] max-w-[400px]`，小屏不溢出。
  - 遮罩层统一为 `--overlay-mask` + 轻 blur（与登录弹窗一致）。
- `chat/src/components/Message/index.vue`
  - 顶部消息条移动端最大宽度提升至 `92vw`，长文案依旧 `truncate`，避免小屏顶端“卡边”。
  - 文案色改为 `--text-primary`，避免浅/深主题对比度不稳。
- `chat/src/views/chat/components/sider/index.vue`
  - 移动端侧栏抽屉宽度改为 `w-[82vw] max-w-[260px]`，在 480/更窄屏幕更稳。
  - 底部分割线改用 `--glass-border`，清理残留 `gray-*` 硬编码。
- `chat/src/views/chat/components/Header/index.vue`
  - 外部链接区域残留 `gray-*` 文本/底色替换为 `--text-* / --glass-*` Token。
  - 标题截断最大宽度在小屏更宽（`max-w-[70vw]/[60vw]`），减少“过早省略”。
- `chat/src/components/BadWordsDialog.vue` / `chat/src/components/Dialogs/BadWordsDialog.vue`
  - 遮罩层改为 `--overlay-mask` + blur；内容容器改为 `glass-card + aurora-border`，并在小屏使用 `w-[92vw]`。
- `chat/src/components/HtmlDialog.vue`
  - 遮罩层改为 `--overlay-mask` + blur，浅色主题不再被纯黑压暗。
- `chat/src/components/Identity.vue` / `chat/src/components/PhoneIdentity.vue`
  - 遮罩层改为 `--overlay-mask` + blur；弹窗外壳改为 `glass-card + aurora-border`（表单逻辑不动）。
- `chat/src/styles/index.css`
  - 新增基础键盘可访问性：`focus-visible` 统一使用 Token 驱动的 outline（不影响鼠标交互）。

#### 9.2 构建验证（阶段 9）

- 已执行生产构建并记录日志：`chat/build.stage9.log`
  - 构建成功（存在非致命提示：Browserslist 数据过期、chunk 体积告警）。

#### 9.3 你需要检查什么（阶段 9 验收清单）

1. **断点布局（浅/深主题都要看）**

- 1440 / 1200 / 1024：侧栏展开/折叠不遮挡主内容；Header 标题截断合理；主面板无横向滚动条。
- 768 / 480：移动端布局无溢出；侧栏抽屉宽度合适；按钮/输入框可点不被遮挡。

2. **弹窗/遮罩一致性**

- Confirm/Html/合规提示/实名认证/手机号绑定：遮罩强度一致（浅色不被压黑），弹窗在小屏不溢出。

3. **消息提示条**

- 顶部提示在小屏不贴边、不溢出；长文案省略正确；浅/深主题文字对比度稳定。

4. **基础可访问性**

- 键盘 `Tab` 导航：按钮/链接/输入框能看到清晰的 focus outline（不会完全无焦点提示）。

5. **关键交互不回归（抽查）**

- 发送消息/停止流式、切会话、打开设置、打开登录与验证码流程：仅样式变化，无行为回归。

---

## 阶段 10｜Markdown + LaTeX（KaTeX）渲染统一（已验收完毕）

> 背景：发现“公告栏能渲染数学公式，但聊天对话气泡（用户/AI）不渲染”。该问题与阶段 1-9 的 UI 换皮无直接关系，属于“渲染链路不一致 + 用户气泡默认纯文本输出”的历史行为问题。

### 10.1 已落地的文件改动（阶段 10）

- `chat/src/views/chat/components/Message/Text/index.vue`
  - **用户气泡渲染方式调整**：
    - 由原先 `v-text`（纯文本）改为使用 `v-html` 输出渲染后的 HTML，并套用 `markdown-body`（与 AI 气泡一致的 Markdown 样式体系）。
    - 用户消息同样支持 Markdown + LaTeX（KaTeX）。
  - **AI 气泡渲染方式保持**：AI 消息仍为 `markdown-it` 渲染后 `v-html` 输出（原逻辑保留）。
  - **渲染链路统一**：新增 `mdiUser`（用户消息专用 MarkdownIt 实例），与 AI 的 `mdi` 一致启用 `@traptitech/markdown-it-katex`。
    - 用户消息侧强制 `html: false`（避免用户输入 HTML 造成注入风险）。
    - 用户消息侧启用 `breaks: true`（保留用户换行体验）。
  - **LaTeX 兼容修复**：对 `\\(\\)` / `\\[\\]` 这类“多重反斜杠”形式进行 normalize，提升不同模型输出格式下的公式命中率。
  - **模板可编译性修复**：将“后续提问建议”的字符串解析从模板内迁移到 `computed`，避免在 Vue 模板中出现 TS 类型标注/断言导致的解析错误。

### 10.2 为什么“勾股定理的 a^2+b^2=c^2”没渲染？

- **KaTeX/Markdown 的常规做法**：只渲染“被分隔符包裹的 LaTeX 片段”，例如：
  - 行内：`$a^2+b^2=c^2$`
  - 块级：`$$a^2+b^2=c^2$$`
  - 兼容形式：`\\( ... \\)`、`\\[ ... \\]`
- 你示例里的 `a^2 + b^2 = c^2` 属于**纯文本**，没有 `$...$` / `$$...$$` 这类边界标识，因此不会触发数学渲染。
- 许多网站不会出现该问题，通常是因为它们在 **system prompt/预设** 中强制模型“数学必须用 LaTeX 分隔符输出”，或者使用“自动识别/猜测公式”的渲染策略（该策略可能误判，且性能/安全成本更高）。

### 10.3 管理端“全局头部预设 / 模型预设”是否是系统提示词？

- 是。管理端存在两类预设：
  - **全局头部预设**：`admin/src/views/models/baseSetting.vue` 中的 `systemPreMessage`。
  - **模型预设**：`admin/src/views/models/key.vue` 中的 `systemPrompt` 与 `systemPromptType`（关闭/附加/覆盖）。
- 后端会根据 `systemPromptType` 组合系统消息（见 `service/src/modules/chat/chat.service.ts`）。

**推荐预设文案（建议写到“全局头部预设”或某个模型预设里）**

```text
请用 Markdown 输出。
所有数学公式必须用 LaTeX，并用 $...$（行内）或 $$...$$（块级，必须换行后输出这个）包裹。
行内：即使是 a^2、c^2 这类简单表达式也要写成 $a^2$、$c^2$，不要输出裸的 a^2。
块级例子：
文本
$$
公式a
$$
文本

```

### 10.4 构建验证（阶段 10）

- 已执行生产构建并记录日志：`chat/build.math-render.log`
  - 构建成功（存在非致命提示：Browserslist 数据过期、chunk 体积告警）。

### 10.5 你需要检查什么（阶段 10 验收清单）

1. **用户气泡渲染（关键）**

- 发送包含 Markdown 的用户消息：标题/列表/代码块样式正常。
- 发送包含公式的用户消息：`$E=mc^2$`、`$$\\int_0^1 x^2 dx$$` 能渲染为公式。

2. **AI 气泡渲染（关键）**

- AI 返回中包含 `$...$` / `$$...$$` 时公式正常渲染。
- AI 返回中出现 `\\( ... \\)` / `\\[ ... \\]` 时同样能渲染。

3. **样式一致性**

- 用户/AI 气泡在浅色/深色主题下均使用同一套 `markdown-body` 排版；长文本不溢出。

4. **安全与行为不回归**

- 用户输入中包含 `<script>`/HTML 标签：不应被当作 HTML 执行（用户侧禁用了 HTML 渲染）。
- 发送消息、复制、编辑消息、后续提问建议按钮点击：行为不变，仅渲染增强。
