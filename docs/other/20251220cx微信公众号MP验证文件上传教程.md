# 微信公众号 MP 验证文件上传教程（以 lumamemo.com 为例）

> 目标：把微信给的 `MP_verify_*.txt` 文件放到**网站根目录**，让微信能通过 URL 直接访问到它。
>
> 成功标准：访问 `https://你的域名/MP_verify_xxx.txt` 返回一串验证码内容，且不 404。

---

## 1. 你需要准备什么

- 微信弹窗提供的验证文件：`MP_verify_WZpl9KYwGaNZ3NhU.txt`
  - **文件名不要改**（包括大小写）。
  - 文件内容是一串字符串：`WZpl9KYwGaNZ3NhU`

---

## 2. 核心概念：什么是“网站根目录”

微信验证时会请求这个路径：

- `https://lumamemo.com/MP_verify_WZpl9KYwGaNZ3NhU.txt`

所以这个文件必须存在于你对外提供静态文件的**根目录**中，即：

- Nginx 配置里的 `root` 指向的目录
- 或者你反向代理到的应用（Node/Express 等）对外提供静态资源的根目录

只要能从域名根路径直接访问到这个文件，就算成功。

---

## 3. 两种常见部署方式的操作步骤

### A) 你使用宝塔（Baota）面板

1. 登录宝塔面板
2. 进入：**文件**
3. 找到你的网站目录（常见位置示例）：
   - `/www/wwwroot/lumamemo/`
   - 或者某个 `public/`、`dist/` 目录（以你站点实际 `root` 为准）
4. 点击 **上传**，把 `MP_verify_WZpl9KYwGaNZ3NhU.txt` 上传进去
5. 上传后立刻自测：
   - 访问：`https://lumamemo.com/MP_verify_WZpl9KYwGaNZ3NhU.txt`
   - 看到 `WZpl9KYwGaNZ3NhU`（一串字符串）即成功

> 如果访问 404：说明文件放错目录了，回到第 3 步确认站点配置的 `root`。

---

### B) 你使用 Nginx / Docker（反代 + 静态目录）

#### 第 1 步：确认“root 对应的目录”

你需要先确认：外网访问 `https://lumamemo.com/` 时，服务器实际从哪个目录提供静态文件。

- 如果你是 Nginx 直接托管静态站点：看 Nginx 配置的 `root`。
- 如果你是 Nginx 反向代理到 Node 服务：看 Node 服务的静态目录映射（例如 Express 的 `express.static()`）。

#### 第 2 步：把验证文件放到该目录

本工作区（/home/ubuntu/99ai）里的部署目录中，实测可用的位置是：

- `AIWebQuickDeploy/public/chat/`

也就是把文件放到：

- `AIWebQuickDeploy/public/chat/MP_verify_WZpl9KYwGaNZ3NhU.txt`

你可以在服务器上执行：

```bash
# 在服务器上，把验证文件复制到站点静态根目录
cp /home/ubuntu/99ai/MP_verify_WZpl9KYwGaNZ3NhU.txt \
  /home/ubuntu/99ai/AIWebQuickDeploy/public/chat/MP_verify_WZpl9KYwGaNZ3NhU.txt
```

#### 第 3 步：本机自测（不走域名，先确认服务真的能吐出文件）

如果你的服务端口是 `9520`（本项目的常见端口），可以先在服务器本机测试：

```bash
curl -sS http://127.0.0.1:9520/MP_verify_WZpl9KYwGaNZ3NhU.txt
```

期望输出：

- `WZpl9KYwGaNZ3NhU`

#### 第 4 步：外网自测（走域名）

浏览器打开：

- `https://lumamemo.com/MP_verify_WZpl9KYwGaNZ3NhU.txt`

成功表现：

- 不报错、不跳转
- 页面只显示一串验证码：`WZpl9KYwGaNZ3NhU`

---

## 4. 常见问题排查（最常见是 404）

### 1) 外网 404

说明 **文件不在对外站点根目录**。

处理方法：

- 重新确认 Nginx 的 `root` 指向哪个目录
- 如果是反向代理到 Node：确认 Node 是否把该文件所在目录作为静态根
- 确认文件名完全一致：`MP_verify_WZpl9KYwGaNZ3NhU.txt`

### 2) 外网返回的是 HTML（而不是那串验证码）

通常说明被 SPA 路由兜底（例如所有未知路径都返回 `index.html`）。

处理方法：

- 把该文件放到真正的静态根目录（能被静态文件中间件优先命中）
- 或在 Nginx 增加该文件的精确 location 规则（如你会改 Nginx 配置）

### 3) 浏览器缓存/CDN 缓存

如果你用了 CDN 或强缓存，可能需要刷新缓存，或用无痕窗口测试。

---

## 5. 验证通过后要不要删文件？

一般建议保留，避免微信后续校验或你重新绑定时需要再次上传。

---

## 6. 本项目已完成的操作记录（供你核对）

- 已将验证文件放置到：
  - `AIWebQuickDeploy/public/chat/MP_verify_WZpl9KYwGaNZ3NhU.txt`
- 服务器本机访问（端口 9520）已能返回验证码内容。

> 自动化说明（推荐）：
> - 现在打包脚本 `build.sh` 会在每次打包时自动把 `docs/MP_verify_*.txt` 复制到 `AIWebQuickDeploy/public/chat/`。
> - 只要你把微信提供的验证文件放进 `docs/` 目录并提交到仓库，后续 CI/部署就不需要再手工复制。

如果你希望我进一步帮你核对“lumamemo.com 对应的 Nginx root/反代配置”，把 Nginx 配置文件路径或宝塔站点配置截图发我即可。
