# 99AI-ANKI 项目运行指南

## 📋 前置要求

### 1. 安装 Node.js
- 推荐使用 Node.js 18 或更高版本（建议使用 Node.js 22）
- 如果使用 nvm 管理版本：
  ```bash
  nvm install 22
  nvm use 22
  ```

### 2. 安装包管理器
```bash
npm install -g pnpm
```

### 3. 安装数据库和缓存
- **MySQL**：需要创建一个数据库（项目会自动创建表结构）
- **Redis**：用于缓存和会话管理

### 4. 安装 PM2（生产环境）
```bash
npm install -g pm2
```

---

## 🚀 运行方式

### 方式一：开发模式（推荐用于开发调试）

#### 1. 配置环境变量

进入 `service` 目录，创建 `.env` 文件（如果不存在）：

```bash
cd service
```

需要配置的主要环境变量：
- `REDIS_HOST` - Redis 主机地址（默认：localhost）
- `REDIS_PORT` - Redis 端口（默认：6379）
- `REDIS_PASSWORD` - Redis 密码（如果有）
- `REDIS_DB` - Redis 数据库编号（默认：0）
- `DB_HOST` - MySQL 主机地址
- `DB_PORT` - MySQL 端口（默认：3306）
- `DB_USERNAME` - MySQL 用户名
- `DB_PASSWORD` - MySQL 密码
- `DB_DATABASE` - MySQL 数据库名
- `PORT` - 服务端口（默认：49520）

#### 2. 安装依赖并启动后端服务

```bash
cd service
pnpm install
pnpm dev
```

后端服务将在 `http://localhost:49520` 启动

#### 3. 启动前端（用户端）

打开新的终端窗口：

```bash
cd chat
pnpm install
pnpm dev
```

用户端前端通常会在 `http://localhost:9002` 或类似端口启动

#### 4. 启动管理后台（可选）

打开另一个终端窗口：

```bash
cd admin
pnpm install
pnpm dev
```

管理后台通常会在 `http://localhost:9001` 或类似端口启动

---

### 方式二：生产模式（使用构建后的文件）

#### 1. 构建项目

在项目根目录执行构建脚本：

```bash
./build.sh
```

或者在 Windows 上：
```bash
bash build.sh
```

这个脚本会：
- 构建 `admin` 前端
- 构建 `chat` 前端
- 构建 `service` 后端
- 将所有构建产物复制到 `AIWebQuickDeploy` 目录

#### 2. 进入部署目录

```bash
cd AIWebQuickDeploy
```

#### 3. 配置环境变量

复制 `.env.example` 为 `.env` 并修改配置：

```bash
cp .env.example .env
# 然后编辑 .env 文件，配置数据库和 Redis 连接信息
```

#### 4. 安装依赖并启动

```bash
pnpm install
pnpm start
```

#### 5. 查看日志

```bash
pnpm logs
```

项目默认在 `49520` 端口运行，访问地址：
- **用户端**：`http://localhost:49520/chat`
- **管理后台**：`http://localhost:49520/admin`

---

### 方式三：Docker 部署

#### 1. 进入部署目录

```bash
cd AIWebQuickDeploy
```

#### 2. 启动服务

```bash
docker-compose up -d
```

#### 3. 查看日志

```bash
docker-compose logs
```

#### 4. 停止服务

```bash
docker-compose down
```

---

## 🔐 默认账号

- **管理端地址**：`项目链接/admin`
- **普通管理员账号**：`admin`（默认不激活）
- **超级管理员账号**：`super`
- **默认密码**：`123456`

⚠️ **重要**：首次登录后请及时修改密码！

---

## 📝 注意事项

1. **数据库**：确保 MySQL 数据库已创建，项目会自动创建表结构，无需手动导入 SQL
2. **Redis**：确保 Redis 服务正在运行
3. **端口冲突**：如果端口被占用，可以在环境变量中修改端口号
4. **跨域问题**：开发模式下，确保前端代理配置正确指向后端地址
5. **环境变量**：生产环境务必配置好所有必要的环境变量

---

## 🛠️ 开发建议

- 开发时使用**方式一**（开发模式），支持热重载
- 生产部署使用**方式二**或**方式三**（构建后运行或 Docker）
- 查看 `docs/DEVELOPMENT.md` 了解更多开发细节
- 查看 `docs/DEPLOYMENT.md` 了解更多部署细节

---

## ❓ 常见问题

### 1. 依赖安装失败
尝试使用国内镜像源：
```bash
pnpm config set registry https://registry.npmmirror.com
```

### 2. 数据库连接失败
检查 `.env` 文件中的数据库配置是否正确，确保数据库服务正在运行

### 3. Redis 连接失败
检查 Redis 服务是否启动，以及 `.env` 中的 Redis 配置

### 4. 端口被占用
修改 `.env` 文件中的 `PORT` 配置，或关闭占用端口的程序

